---
title: "Extracting model results for thesis"
author: "Vera Vinken"
date: "`r Sys.Date()`"
output: html_document
---
  
 

```{r packages}

# Load packages 
  library(ggplot2)
   library(gridExtra)       # grids of ggplots 
  library('parallel')       # for parallel computing
  library('doParallel')     # As above 
  library(dplyr)            # merging dataframes, using mutate etc. 
  library(purrr)            # To use the dataframe mapping functions 
  library(truncnorm)        # creating normal distributions 
  library(data.table)
  library(foreach)
  library(doParallel)
  library(ggpubr)             # To arrange plots 
  library(gridExtra)          # for grid.arrange 
  library(pracma)
  library(stringr)
  library(plotly)
  library(hrbrthemes)
  library(tibble)
  library(here)
  library(Hmisc)
  library(tidyr)
  library(scales)
library(stringr)  # Make sure you load the stringr package

```

## Background 
With this script, I want to be able to input which models to run and what type of output I want. The rest should be automated and pull from the sorucefiles that I have built my models from. Ideally, I want this to be the file that Tom can use in future, zipped up with all the dependencies so it is very easy to extract data. 


## Set working directories & Load sourcefiles 
If this is running from the shared Rproject, this should all be automated. 
```{r set wd and load sourcefiles, include=TRUE, message=FALSE, echo=F, warning=FALSE}
# Set directories 
  # # Where are the sourcefiles located? 
  sourcefile_wd<-i_am("Run_models_thesis.Rmd")
  sourcefile_wd<-here()
  # # Specify the parent folder where you want to save results 
  # #parent_saving_wd<-"C:/Users/c0070955/OneDrive - Newcastle University/1-PHD-project/Modelling/R/Model_output/Post_param_results_October23" 

# Load the sourcefiles 
  setwd(sourcefile_wd)
  source('MOD_1_FuncSource.R')
  source('ModelSource.R')

```

## Compare branching performance 

Can only be done for the x1 and x2 models, as they ran through the branches fully. 

```{r compare branching performance}
setwd(sourcefile_wd)
opt_res<-read.csv("branch_comparison_all.csv")

opt_res<-pivot_longer(opt_res, c(b4, b6, b8, b10, b12))
opt_res$name <- factor(opt_res$name, levels = c("b4", "b6", "b8", "b10", "b12"), ordered = TRUE)
opt_res$Model.num<-factor(opt_res$Model.num, levels = c("11", "21", "31", "41", "51", "61","12", "22", "32", "42", "52", "62", 
                                                        "13", "23", "33", "43", "53", "63","14", "24", "34", "44", "54", "64"))
opt_res$Model.type<-factor(opt_res$Model.type, levels = c("SC - H", "FR - H ", "FCR - H", "FR -FCR - H", "SC - FR - H", "SC - FCR - H ",
                                                          "SC - NH", "FR - NH ", "FCR - NH", "FR -FCR - NH", "SC - FR - NH", "SC - FCR - NH ", 
                                                          "SC-DH1", "FR-DH1", "FCR-DH1", "FR-FCR-DH1", "SC-FR-DH1", "SC-FCR-DH1", 
                                                          "SC-DH2", "FR-DH2", "FCR-DH2", "FR-FCR-DH2", "SC-FR-DH2", "SC-FCR-DH2"))
opt_res$days<-(opt_res$value/72)
ggplot(opt_res%>%filter(Model.num == "11"), aes(x = Model.num, y = days, fill = name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Model Type", y = "Mean halflife survival (days)", fill = "Branch") +
  vera_theme(bg = "white")

ggplot(opt_res %>% filter(Model.num %in% c("11", "12", "21", "22", "31", "32", "41", "42", "51", "52", "61", "62")), 
       aes(x = Model.num, y = days, fill = name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Decision rule", y = "Mean halflife survival (days)", fill = "Branch") +
  vera_theme(bg = "white")


p<-ggplot(opt_res %>% filter(Model.num %in% c("11", "12", "21", "22", "31", "32", "41", "42", "51", "52", "61", "62")), 
       aes(x = Model.num, y = days, fill = name)) +
  geom_bar(stat = "identity", position = "dodge")+
  labs(x = "Decision rule", y = "Mean halflife survival (days)", fill = "Branch") +
  scale_fill_manual(values = c("#666963", "#969c8f", "#ac705d", "#e2ac76", "#f8e09d")) +  # specify your hex colors here
  vera_theme(bg = "white")

ggplot(opt_res %>% filter(Model.num %in% c("11", "12", "21", "22", "31", "32", "41", "42", "51", "52", "61", "62")), 
       aes(x = Model.num, y = days, fill = name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Model Type", y = "Mean halflife survival (days)", fill = "Branch") +
  scale_fill_manual(values = c("#666963", "#969c8f", "#a5644e", "#be6f1f", "#f3cc5e")) +  # specify your hex colors here
  vera_theme(bg = "white")

p <- ggplot(opt_res %>% filter(Model.num %in% c("11", "12", "21", "22", "31", "32", "41", "42", "51", "52", "61", "62")), 
            aes(x = Model.num, y = days, fill = name)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Decision rule", y = "Mean halflife survival (days)", fill = "Branch") +
  scale_fill_manual(values = c("#666963", "#969c8f", "#ac705d", "#e2ac76", "#f8e09d")) +  # specify your hex colors here
  scale_y_continuous(breaks = seq(0, max(opt_res$days, na.rm = TRUE), by = 5)) +  # set y-axis breaks every 5
  vera_theme(bg = "white")


## save 
ggsave("standardized_plot_graph_general.png", plot = p, width = 8, height = 4, dpi = 500)  # Specify the size in inches and resolution
ggsave("branching_compare_svg.svg", plot = p, width = 8, height = 4, dpi = 500)  # Specify the size in inches and resolution

```



## Comparing model results 


```{r set which model to run, include=TRUE, warning=FALSE,echo=F, message=FALSE}
# models<-c("11", "21", "31", "41", "51", "61", 
#           "12", "22", "32", "42", "52", "62", 
#           "131", "231", "331", "431", "531", "631", 
#           "132", "232", "332", "432", "532", "632") # Keep this as is (unless runnig models from scratch)
models<-c( "51", "61"
          ) # Keep this as is (unless runnig models from scratch)

int_var<-"stom_con"  # This is hte variable you can chagne in order to inspect specific variables! 

# If you are using the previously generated data, do not change these the code will use teh default settings 
num_birds<-1000
daylight_h<-8
days<-30 
```

## Loop through models 

At the moment (10/10/2024) my decision is to use the branch 6 outcomes. In my results section I'll clarify why I do so. 
5 decimals were used. 

Run all models for set input parameters, across all environments. Save results in list. 

```{r loop through models to run}
for (i in 1:length(models)){
  
  if (i==1){
    # create a list for the output 
    env_func_out_list<-list()
  }
  
  # Model 11 
  if (models[i]==11){
    # Code that runs 11
    env_func_1_1_par(days = days, 
                     N= num_birds, 
                     th_forage_sc = 0.00208, 
                     daylight_h = daylight_h, 
                     modelType = 11, 
                     sourcefile_wd = sourcefile_wd) 
    
  }else if (models[i]==12){
    # Code that runs 12 
    env_func_1_2_par(days = days, 
                     N= num_birds, 
                     th_forage_sc1 = 0.02708, 
                     th_forage_sc2 = 0.08125, 
                     daylight_h = daylight_h, 
                     modelType = 12, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==131){
    # Code that runs 131 
      env_func_1_3_1_par(days = days, 
                         N= num_birds, 
                         th_forage_sc1 = 0.03125, 
                         th_forage_sc2 = 0.08958, 
                         th_forage_sc3 = 0.29375, 
                         daylight_h = daylight_h, 
                         modelType = 131, 
                         sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==132){
    # Code that runs 132
        env_func_1_3_2_par(days = days, 
                           N= num_birds, 
                           th_forage_sc1 =0.02708, 
                           th_forage_sc2 =0.13125, 
                           th_forage_sc3 =0.13542, 
                           daylight_h = daylight_h, 
                           modelType = 132, 
                           sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==21){
    # Code that runs 21 
    env_func_2_1_par(days = days, 
                     N= num_birds, 
                     th_forage_fr = 1.60417, 
                     daylight_h = daylight_h, 
                     modelType = 21, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==22){
    # Code that runs 22 
    env_func_2_2_par(days = days, 
                     N= num_birds, 
                     th_forage_fr1 = 1.02083, 
                     th_forage_fr2 = 1.43750, 
                     daylight_h = daylight_h, 
                     modelType = 22, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==231){
    # Code that runs 231 
      env_func_2_3_1_par(days = days, 
                         N= num_birds, 
                         th_forage_fr1 = 0.39583, 
                         th_forage_fr2 = 1.39583 , 
                         th_forage_fr3 = 2.93750, 
                         daylight_h = daylight_h, 
                         modelType = 231, 
                         sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==232){
    # Code that runs 232 
    env_func_2_3_2_par(days = days, 
                       N= num_birds, 
                       th_forage_fr1 = 0.39583, 
                       th_forage_fr2 = 2.22917, 
                       th_forage_fr3 = 3.81250, 
                       daylight_h = daylight_h, 
                       modelType = 232, 
                       sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==31){
    # Code that runs 31 
    env_func_3_1_par(days = days, 
                     N= num_birds, 
                     th_forage_flr = 0.23125, 
                     daylight_h = daylight_h, 
                     modelType = 31, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==32){
    # Code that runs 32 
    env_func_3_2_par(days = days, 
                     N= num_birds, 
                     th_forage_flr1 = -0.06875, 
                     th_forage_flr2 = 0.11875, 
                     daylight_h = daylight_h, 
                     modelType = 32, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==331){
    # Code that runs 331 
    env_func_3_3_1_par(days = days, 
                       N= num_birds, 
                       th_forage_flr1 = -0.13125, 
                       th_forage_flr2 = 0.21875, 
                       th_forage_flr3 = 0.41875, 
                       daylight_h = daylight_h, 
                       modelType = 331, 
                       sourcefile_wd = sourcefile_wd)
    
  } else if (models[i]==332){
    env_func_3_3_2_par(days = days, 
                       N= num_birds, 
                       th_forage_flr1 = -0.11875, 
                       th_forage_flr2 = 0.25625, 
                       th_forage_flr3 = 0.49375, 
                       daylight_h = 8, 
                       modelType = 332, 
                       sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]==41){
    env_func_4_1_par(days = days, 
                     N = num_birds,
                     th_forage_fr= 1.52083, 
                     th_forage_flr= -0.00625, 
                     daylight_h = daylight_h, 
                     modelType = 41, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i] == 51){
        env_func_5_1_par(days = days, 
                     N = num_birds,
                     th_forage_sc= 0.03125, 
                     th_forage_fr = 0.31250, 
                     daylight_h = daylight_h, 
                     modelType = 51, 
                     sourcefile_wd = sourcefile_wd)
    
  }else if (models[i] == 61){
        env_func_6_1_par(days = days, 
                     N = num_birds,
                     th_forage_sc= 0.01458, 
                     th_forage_flr = -0.58125, 
                     daylight_h = daylight_h, 
                     modelType = 61, 
                     sourcefile_wd = sourcefile_wd)
    
  } else if (models[i] == 42){
    env_func_4_2_par(days = days, 
                     N = num_birds, 
                     th_forage_fr1 = 1.31250, 
                     th_forage_fr2 = 1.354167, 
                     th_forage_flr1 = -0.03125, 
                     th_forage_flr2 = 0.00625, 
                     daylight_h = daylight_h, 
                     modelType = 42, 
                     sourcefile_wd = sourcefile_wd)
    
  }else if (models[i] == 52){
    env_func_5_2_par(days = days, 
                     N = num_birds, 
                     th_forage_sc1 = 0.06458, 
                     th_forage_sc2 = 0.1145833, 
                     th_forage_fr1 = 1.3125, 
                     th_forage_fr2 = 1.39583, 
                     daylight_h = daylight_h, 
                     modelType = 52, 
                     sourcefile_wd = sourcefile_wd)
    
  }else if (models[i] == 62){
    env_func_6_2_par(days = days, 
                     N = num_birds, 
                     th_forage_sc1 = 0.05208, 
                     th_forage_sc2 = 0.09792, 
                     th_forage_flr1 = -0.20625, 
                     th_forage_flr2 = -0.18125, 
                     daylight_h = daylight_h, 
                     modelType = 62, 
                     sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]== 431){
    env_func_4_3_1_par(days = days, 
                       N = num_birds, 
                       th_forage_fr1 =  0.68750 , 
                       th_forage_fr2 = 1.35417,
                       th_forage_fr3 = 3.14585, 
                       th_forage_flr1 = -0.09375, 
                       th_forage_flr2 = 0.21875, 
                       th_forage_flr3 = 0.46875, 
                       daylight_h = daylight_h, 
                       modelType = 431, 
                       sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]== 531){
    env_func_5_3_1_par(days = days, 
                       N = num_birds, 
                       th_forage_sc1 = 0.00625, 
                       th_forage_sc2 = 0.08542,
                       th_forage_sc3 = 0.31877, 
                       th_forage_fr1 = 0.7291667, 
                       th_forage_fr2 = 1.562507, 
                       th_forage_fr3 = 2.104173, 
                       daylight_h = daylight_h, 
                       modelType = 531, 
                       sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]== 631){
    env_func_6_3_1_par(days = days, 
                       N = num_birds, 
                       th_forage_sc1 = 0.05626, 
                       th_forage_sc2 = 0.07708,
                       th_forage_sc3 = 0.3146, 
                       th_forage_flr1 = 0.04375, 
                       th_forage_flr2 = 0.24375, 
                       th_forage_flr3 = 0.54375, 
                       daylight_h = daylight_h, 
                       modelType = 631, 
                       sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]== 432){
    env_func_4_3_2_par(days = days, 
                       N = num_birds, 
                       th_forage_fr1 =  0.68750, 
                       th_forage_fr2 = 2.35418,
                       th_forage_fr3 = 3.43751, 
                       th_forage_flr1 = -0.04375, 
                       th_forage_flr2 = 0.28125, 
                       th_forage_flr3 = 0.41875, 
                       daylight_h = daylight_h, 
                       modelType = 432, 
                       sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]== 532){
    env_func_5_3_2_par(days = days, 
                       N = num_birds, 
                       th_forage_sc1 =0.00625, 
                       th_forage_sc2 = 0.09375,
                       th_forage_sc3 =0.27709 , 
                       th_forage_fr1 = 0.89584, 
                       th_forage_fr2 = 2.52085, 
                       th_forage_fr3 = 3.06252, 
                       daylight_h = daylight_h, 
                       modelType = 532, 
                       sourcefile_wd = sourcefile_wd)
    
  }else if (models[i]== 632){
    env_func_6_3_2_par(days = days, 
                       N = num_birds, 
                       th_forage_sc1 = 0.11459, 
                       th_forage_sc2 =0.22293 ,
                       th_forage_sc3 = 0.33543, 
                       th_forage_flr1 = 0.19375, 
                       th_forage_flr2 = 0.23125, 
                       th_forage_flr3 = 0.46875, 
                       daylight_h = daylight_h, 
                       modelType = 632, 
                       sourcefile_wd = sourcefile_wd)
  }
  
    # wrap up 
  output_env_func[[3]]<-models[i]
  
  # Now save the result of this iteration in a meaningful way 
  env_func_out_list[[i]]<-output_env_func
  
  print(paste("model done=", models[i]))
  
}

# make sure that the lists inside the list have the right name 
names(env_func_out_list)<-models
 setwd(sourcefile_wd)
 save(env_func_out_list, file="results_5161.Rda")

```

## Merge the dataframes 

```{r merge model dataframes}
# Assuming your outer list is named 'model_list'
# The names of the list items are 11, 21, 31, etc.

# Iterate over the outer list
for (i in seq_along(env_func_out_list)) {
  # Get the current name (11, 21, 31, etc.)
  model_name <- names(env_func_out_list)[i]
  
  # Extract the list of 12 dataframes (second item in each sublist)
  df_list <- env_func_out_list[[i]][[2]]
  
  # Iterate over each dataframe in this list
  for (j in seq_along(df_list)) {
    env<-j
    # Add the "model_type" column to each dataframe
    df_list[[j]]$model_type <- model_name
    df_list[[j]]$env<-env
  }
  
  # Update the list with the modified list of dataframes
  env_func_out_list[[i]][[2]] <- df_list
}

# Initialize an empty list to hold all dataframes
all_dfs<- list()

# Iterate over the outer list
for (i in seq_along(env_func_out_list)) {
  # Extract the list of 12 dataframes (second item in each sublist)
  df_list <- env_func_out_list[[i]][[2]]
  
  # Combine the dataframes in the current list and store them
  all_dfs <- c(all_dfs, df_list)
}

# Combine all dataframes into one dataframe
df<- do.call(rbind, all_dfs)

# clean up 
rm(all_dfs)
rm(df_list)
rm(env_func_out_list)
rm(level2)
rm(output_env_func)
rm(t_HL_list)


# add a chapter label to the df 
df<-df%>%
  mutate(chapter = case_when(
    model_type == "11" ~ 5, 
    model_type == "12" ~ 5, 
    model_type == "131" ~ 5, 
    model_type == "132" ~ 5, 
    model_type == "21" ~ 6, 
    model_type == "22" ~ 6, 
    model_type == "231" ~ 6, 
    model_type == "231" ~ 6, 
    model_type == "31" ~ 6, 
    model_type == "32" ~ 6, 
    model_type == "331" ~ 6, 
    model_type == "332" ~ 6, 
    model_type == "41" ~ 6, 
    model_type == "42" ~ 6, 
    model_type == "431" ~ 6, 
    model_type == "432" ~ 6,
    model_type == "51" ~ 7, 
    model_type == "52" ~ 7, 
    model_type == "531" ~ 7, 
    model_type == "532" ~ 7, 
    model_type == "61" ~ 7, 
    model_type == "62" ~ 7, 
    model_type == "631" ~ 7, 
    model_type == "632" ~ 7, 
  ))%>%
        mutate(temp=if_else((.$env=="1"|.$env=="3"|.$env=="5"|.$env=="7"|.$env=="9"|.$env=="11"), "low", "high"))%>%
        mutate(food_ab=case_when(
          env<5 ~ "low", 
          env>4 & env<9 ~ "medium", 
          env>8 ~ "high"
        ))%>%
        mutate(food_pred=if_else((.$env=="1"|.$env=="2"|.$env=="5"|.$env=="6"|.$env=="9"|.$env=="10"), "Poisson", "Bonanza"))%>%
  mutate(timestep_within_day=timestep%%72)

df$food_pred <- factor(df$food_pred, levels = c( "Poisson", "Bonanza"), ordered = TRUE)

save(df, file = "df_all_models_standard.Rda")
```

## set the caches to 0 where needed

```{r set caches to 0}
df<-df%>%
  mutate(value = case_when(
    (id == "caches" & model_type =="41") ~ 0, 
    (id == "caches" & model_type =="51") ~ 0, 
    (id == "caches" & model_type =="61") ~ 0, 
    TRUE ~ value
  ))


df <- df %>%
  mutate(hoard_type = case_when(
    str_detect(model_type, "31$") ~ 3,   # Match model_type that ends with "31"
    str_detect(model_type, "32$") ~ 4,    # Match model_type that ends with "32"
    str_detect(model_type, "1$") ~ 1,    # Match model_type that ends with "1"
    str_detect(model_type, "2$") ~ 2    # Match model_type that ends with "2"
    
  ))%>%
  mutate(hoard_type = case_when(
    model_type == "31" ~ 1, 
    model_type == "32" ~ 2,
    TRUE ~hoard_type
    
  ))%>%
  mutate(var_type = case_when(
    str_detect(model_type, "^1") ~ 1,    # Match model_type that starts with "1"
    str_detect(model_type, "^2") ~ 2,    # Match model_type that starts with "2"
    str_detect(model_type, "^3") ~ 3,   # Match model_type that starts with "3"
    str_detect(model_type, "^4") ~ 4,    # Match model_type that starts with "4"
    str_detect(model_type, "^5") ~ 5,
    str_detect(model_type, "^6") ~ 6
  ))

df$var_type <-as.factor(df$var_type)
df$hoard_type<-as.factor(df$hoard_type)

```

```{r splitting models}
m13<-df%>%filter(model_type =="131", (id =="eat_hoard"|id=="dir_hoard"))
m14<-df%>%filter(model_type =="132", (id =="eat_hoard"|id=="dir_hoard"))
m23<-df%>%filter(model_type =="231", (id =="eat_hoard"|id=="dir_hoard"))
m24<-df%>%filter(model_type =="232", (id =="eat_hoard"|id=="dir_hoard"))
m33<-df%>%filter(model_type =="331", (id =="eat_hoard"|id=="dir_hoard"))
m34<-df%>%filter(model_type =="332", (id =="eat_hoard"|id=="dir_hoard"))
m43<-df%>%filter(model_type =="431", (id =="eat_hoard"|id=="dir_hoard"))
m44<-df%>%filter(model_type =="432", (id =="eat_hoard"|id=="dir_hoard"))
m53<-df%>%filter(model_type =="531", (id =="eat_hoard"|id=="dir_hoard"))
m54<-df%>%filter(model_type =="532", (id =="eat_hoard"|id=="dir_hoard"))
m63<-df%>%filter(model_type =="631", (id =="eat_hoard"|id=="dir_hoard"))
m64<-df%>%filter(model_type =="632", (id =="eat_hoard"|id=="dir_hoard"))

mean(m13$value, na.rm=T) # yes
mean(m14$value, na.rm=T) # yes 
mean(m23$value, na.rm=T) # no 
mean(m24$value, na.rm=T) # no 
mean(m33$value, na.rm=T) # no 
mean(m34$value, na.rm=T) # no 



ch5_col<-c("#FFBD30", "#CA5D05", "#2E5F14", "#8DA27F", "blue", "red")
p<-ggplot(df %>% filter((id == "dir_hoard"|id=="eat_hoard"), 
                        (model_type =="631"|model_type =="632")), 
       aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 1, alpha = 0.5) +
  facet_wrap(~env, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +  # Change x-axis label to "Days"
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
   theme(legend.position = "bottom")#+  # Move legend to the bottom

p


```

## Chapter 5

### Survival chapter 5

```{r graphs chapter survival 5}

ch5_surv<-df%>%
  filter(id == "alive")%>%
  filter((env==6)|env==8)%>%
  filter(chapter ==5)
# set the colours
# I need 4 colours for the 4 models 

#ch4_col<-c("#AA4499", "#DDCC77", "#44AA99", "#332288")
ch5_col<-c("#283F80", "#A8BCC6", "#3CBFC1","#3F8069", "#8DA27F", "#88CCEE")

ggplot(df%>%filter(id == "alive"), aes(y= value, x = timestep, col = model_type))+
  geom_line()+
  facet_wrap(~env, ncol = 2)+
  vera_theme(bg = "white")



## survival across environment 5 and 6 
p<-ggplot(df %>% filter(id == "alive", chapter == 5, (env == 8 | env == 6)), 
       aes(y = value, x = timestep, lty = model_type, col = model_type)) +
  geom_line(size = 1) +
  facet_wrap(~food_pred, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +  # Change x-axis label to "Days"
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed",  "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  scale_color_manual(values = ch5_col, 
                     name = "Hoarding type", 
                     labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop"))
p

# Save the plot with specified size and resolution
ggsave("ch5_survival_png.png", plot = p, width = 7.1, height = 4, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch5_survival_svg.svg", plot = p, width = 7.1, height = 4, dpi = 500)  # Specify the size in inches and resolution
```


###  chapter 5 physiology 
```{r chapter 5 physiology }
ch5_col<-c("#283F80", "#A8BCC6", "#3CBFC1","#3F8069", "#8DA27F", "#88CCEE")
#ch5_col<-c("#283F80", "#3F8069", "#3CBFC1", "#A8BCC6", "#8DA27F", "#88CCEE")

ch5_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id=="caches"))%>%
  filter((env==6)|env==8)%>%
  filter(chapter ==5)


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))


# Add a column for y-axis limits based on 'id'
df <- df %>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
                          (model_type == "11" | model_type == "12" ), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non-hoarding", "Leftover-hoarding")) +
    scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding")) +
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p


# Save the plot with specified size and resolution
ggsave("ch5_phys_Fig52_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch5_phys_Fig5.2_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
###############################################################################################################################

### supplementary for the direct hoarders ###########

ch5_col<-c("#283F80", "#A8BCC6", "#3CBFC1","#3F8069", "#8DA27F", "#88CCEE")
# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
                          ( model_type == "131" | model_type == "132"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c( "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
    scale_linetype_manual( name = "Hoarding type", 
                        values = c( "dotted", "dotdash"),  # Adjust linetypes as needed
                        labels = c( "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p

# Save the plot with specified size and resolution
ggsave("ch5_phys_supp_FigC1_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg thesis 
ggsave("ch5_phys_supp_Fig_C1_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
###############################################################################################################################


# Now I want to average that across the days 

df_psych_sum<-df%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred)%>%
  summarise(mean_value = mean(value)) %>%
  ungroup()%>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 25
  ))

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), (model_type == "11" | model_type == "12" ), (env == 8 | env == 6), timestep_within_day<=24), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  # vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non-hoarding", "Leftover-hoarding")) +
    # scale_linetype_manual( name = "Hoarding type", 
    #                     values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
    #                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
    # 
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))+    # Add invisible points to set y_max limits
  vera_theme(bg = "white")+
  theme(legend.position = "bottom")  # Move legend to the bottom

p# Save the plot with specified size and resolution
ggsave("ch5_phys_agg_Fig53_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch5_phys_agg_Fig53_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
###############################################################################################################################

### supplementary for the direct hoarders ###########

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), ( model_type =="131" |model_type == "132"), (env == 8 | env == 6), timestep_within_day<=24), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  # vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c( "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
    # scale_linetype_manual( name = "Hoarding type", 
    #                     values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
    #                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
    # 
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))+    # Add invisible points to set y_max limits
  vera_theme(bg = "white")+
  theme(legend.position = "bottom")  # Move legend to the bottom

p# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch5_phys_agg_suppl_FigC2_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

```



###  chapter 5 Behaviour

```{r chapter 5 behaviour }
# Define a named vector for the new labels
id_labels <- c("rest" = "Rest", "eat" = "Eat", "hoard" = "Hoard", "dir_hoard"="Hoard", "retrieve"="Retrieve" )

ch5_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c("11", "12")) %>%
  filter(env %in% c(8, 6)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

p <- ggplot(ch5_beh, 
            aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non-hoarding", "Leftover-hoarding")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("ch5_beh_hoard_Fig54_png.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
#svg for thesis
ggsave("ch5_beh_hoard_Fig54_svg.svg", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
#######################################################################################################################


##### SUPPLEMENTARY DIRECT HOARDERS ############
ch5_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c( "131", "132")) %>%
  filter(env %in% c(8, 6)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

p <- ggplot(ch5_beh, 
            aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
#svg for thesis 
ggsave("ch5_beh_suppl_FigC3_svg.svg", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
#######################################################################################################################


# Now I want to average that across the days 
ch5_beh <- df %>%
  filter(timestep>=216)%>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c("11", "12")) %>%
  filter(env %in% c(8, 6)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

df_beh_sum<-ch5_beh%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter(timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 24, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non-hoarding", "Leftover-hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  ylim(0,1)


p# Save the plot with specified size and resolution
ggsave("ch5_beh_agg_Fig44_png.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch5_beh_agg_Fig55_svg.svg", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
################################################################################################################

## supplemnetary for direct-hoarders ####


# Now I want to average that across the days 
ch5_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c("131", "132")) %>%
  filter(env %in% c(8, 6)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

df_beh_sum<-ch5_beh%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter(timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 24, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c( "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  ylim(0,1)


p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch5_beh_agg_supll_FigC4_svg.svg", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution








################################################################################################################

ch5_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c("11", "12", "131", "132")) %>%
  filter(env %in% c(2,4)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

df_beh_sum<-ch5_beh%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()

p<-ggplot(df_beh_sum %>% filter(timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(env),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 24, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  ylim(0,1)

```


### Ch5 effects of temp and food 

So what happens when we lower the temperature and food availability? 

```{r ch5 lower food avail}

#ch4_col<-c("#AA4499", "#DDCC77", "#44AA99", "#332288")
#ch5_col<-c("#FFBD30", "#CA5D05", "#2E5F14", "#8DA27F")
# Reorder env levels and rename them
df <- df %>%
  mutate(env3 = factor(env, levels = c(6, 8, 5, 7, 2, 4, 1, 3, 10, 12, 9, 11),
                      labels = c("Poisson", "Bonanza", "Poisson low temperature", "Bonanza low temperature", 
                                 "Poisson low food", "Bonanza low food", "Poisson low food + low temperature", "Bonanza low food + low temperature", "10", "12", "9", "11")))

# Plot with ggplot
p <- ggplot(df %>% filter(id == "alive", chapter == 5, (env ==6 | env == 8 | env == 2 | env == 4| env == 5 | env == 7 | env ==1 | env==3), 
                          (model_type =="11"|model_type =="12")), 
            aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 1) +
  facet_wrap(~ env3, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non-hoarding", "Leftover-hoarding", "Direct hoarding Htop", "Direct hoarding Rtop"))+
  theme(legend.position = "bottom")

p

# Save the plot with specified size and resolution
ggsave("ch5_environments_Fig56_png.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch5_environments_Fig56_svg.svg", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
```

### Chapter 5: chaches 

```{r look into caches number}

caches<-df%>%
  filter(id == "caches")%>%
  filter(model_type == "11" |model_type == "12" | model_type == "131" | model_type=="132")%>%
  filter(env == 6 | env == 8)%>%
  group_by(model_type, env)%>%
  ungroup()

p_c <- ggplot(caches, aes(x = timestep, y = value, col = model_type)) +
  geom_line(size = 1) +
  facet_wrap(~ env3, ncol = 2) +
  ylab("Number of caches per bird") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  scale_y_continuous(breaks = seq(0, max(caches$value, na.rm = TRUE), by = 5)) +  # Set y-axis breaks every 5 units
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
  theme(legend.position = "bottom")


# Save the plot with specified size and resolution
ggsave("standardized_plot_caches.png", plot = p_c, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution

```


## Chapter 6

### Survival chapter 6

```{r graphs chapter survival 6}

#ch4_col<-c("#AA4499", "#DDCC77", "#44AA99", "#332288")
#h6_col<-c("#ca5d05", "#dd975e",  "#ffffff","#eecbaf")
ch6_col<-c("#FFBD30", "#A06713", "#8DA27F", "#2E5F14")



# p <- ggplot(df %>% filter(id == "alive", (var_type == "2" | var_type == "3" | var_type == "4"), (env == 8 | env == 6), (model_type == "21"|model_type == "31"|model_type == "41"|model_type == "22"|model_type == "32"|model_type == "42"|model_type == "23"|model_type == "33"|model_type == "43"|model_type == "24"|model_type == "34"|model_type == "44")), 
#             aes(y = value, x = timestep, col = var_type, lty = var_type)) +
#   geom_line(size = 0.75) +
#   facet_wrap(~food_pred, ncol = 2) +
#   ylim(0, 1) +
#   ylab("Proportion of birds alive") +
#   xlab("Days") +
#   scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                      labels = seq(0, 30, by = 5)) +     # Label every 5 days
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch5_col, 
#                      name = "Hoarding type", 
#                      labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
#   scale_linetype_manual(name = "Variable type", values = c("solid", "dashed", "dotted"),  # Set line types for each var_type
#                         labels = c("FR", "FCR", "FR and FCR"))+  # Custom labels for var_type
#   theme(legend.position = "bottom",  # Move legend to the bottom
#         legend.direction = "vertical",  # Stack legend items vertically
#         legend.title = element_text(size = 10),  # Set the font size for the legend title
#         legend.text = element_text(size = 8)) 
# p
# 
# # Save the plot with specified size and resolution
# ggsave("standardized_plot_surv.png", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution


p <- ggplot(df %>% filter(id == "alive", chapter == 6, (env == 8 | env == 6)), 
             aes(y = value, x = timestep, col = var_type, lty = hoard_type)) +
  geom_line(size = 1) +
  facet_wrap(~food_pred, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +  # Change x-axis label to "Days"
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
  scale_color_manual(values = ch6_col,
                     name = "Energy proxy",
                     labels = c("FR", "FCR", "FR & FCR")
                     ) +
  scale_linetype_manual( name = "Hoarding type",
                        values = c("solid", "dashed", "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +  # Update line type labels as needed
  guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type

p


# Save the plot with specified size and resolution
ggsave("ch6_surv_png.png", plot = p, width = 7, height = 4.5, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_surv_svg.svg", plot = p, width = 7, height = 4.5, dpi = 500)  # Specify the size in inches and resolution



```


###  chapter 6 physiology 
```{r chapter 6 physiology }
# take the yekllow for non-hoarders out
ch6_col<-c("#FFBD30", "#A06713","#8DA27F","#ca5d05", "#dd975e","#8C6511", "#FFBD30", "#D8C8A6","#a24b04", "#CA5D05", "#eecbaf", "#8DA27F", "#FFBD30", "#CA5D05", "#2E5F14", "#8DA27F", "#FFBD30", "#CA5D05", "#2E5F14", "#8DA27F")


show_col(ch6_col)

ch6_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" | id == "caches"))%>%
  filter((env==6)|env==8)%>%
  filter(chapter ==6)


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))


# Add a column for y-axis limits based on 'id'
df <- df %>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3 ,
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
                          (model_type == "22" |model_type == "32" |model_type =="42"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "Energy proxy",
                        labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
  guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p

# Save the plot with specified size and resolution
      ggsave("ch6_phys_hoarders_Fig62_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_phys_hoarders_Fig62_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
#       
# 
# # Plot with ggplot
# p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
#                           (model_type == "22" |model_type == "32" |model_type =="42"), 
#                           (env == 2 | env == 4)), 
#             aes(y = value, x = timestep, col =  var_type)) +
#   geom_line(size = 0.75, alpha = 0.5) +
#   facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
#   xlab("Days") +  
#   ylab("Value") +
#   scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                      labels = seq(0, 30, by = 5)) +     # Label every 5 days
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col, 
#                      name = "Energy proxy",
#                         labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
#   guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
#          lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
#   theme(legend.position = "bottom") +  # Move legend to the bottom
#   geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#   geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
# 
# p
# Plot with ggplot

###########################################################################################

# NON HOARDERS PHYSIOLOGY 


p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"), 
                          (model_type == "21"  | model_type == "31" |model_type== "41"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "Energy proxy",
                        labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
  guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p

# Save the plot with specified size and resolution
      ggsave("ch6_phys_nonhoard_Fig63_png.png", plot = p, width = 7, height = 6, dpi = 500)  # Specify the size in inches and resolution
# SVG FOR THESIS 
 ggsave("ch6_phys_nonhoard_Fig63_svg.svg", plot = p, width = 7, height = 6, dpi = 500)  # Specify the size in inches and resolution   

 #####################################################################
# energy proxies whole simulation, only for FR models 
#       # Plot with ggplot
#       p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
#                                 (model_type == "22" |model_type == "21" ), 
#                                 (env == 8 | env == 6)), 
#                   aes(y = value, x = timestep, col =  hoard_type)) +
#         geom_line(size = 0.75) +
#         facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
#         xlab("Days") +  
#         ylab("Value") +
#         scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                            labels = seq(0, 30, by = 5)) +     # Label every 5 days
#         vera_theme(bg = "white") +
#         scale_color_manual(values = ch6_col, 
#                            name = "Hoarding type", 
#                            labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
#         # scale_linetype_manual(name = "Energy proxy", 
#         #                       values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
#         #                       labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
#         guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
#                lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
#         theme(legend.position = "bottom") +  # Move legend to the bottom
#         geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#         geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
#       
#       p
#       
#       
#       # Save the plot with specified size and resolution
#       ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# 
# 
# # energy proxies whole simulation, only for FCR models 
#       # Plot with ggplot
#       p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
#                                 (model_type == "32" |model_type == "31" ), 
#                                 (env == 8 | env == 6)), 
#                   aes(y = value, x = timestep, col =  hoard_type)) +
#         geom_line(size = 0.75) +
#         facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
#         xlab("Days") +  
#         ylab("Value") +
#         scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                            labels = seq(0, 30, by = 5)) +     # Label every 5 days
#         vera_theme(bg = "white") +
#         scale_color_manual(values = ch6_col, 
#                            name = "Hoarding type", 
#                            labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
#         # scale_linetype_manual(name = "Energy proxy", 
#         #                       values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
#         #                       labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
#         guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
#                lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
#         theme(legend.position = "bottom") +  # Move legend to the bottom
#         geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#         geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
#       
#       p
#       
#       
#       # Save the plot with specified size and resolution
#       ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# 
# # energy proxies whole simulation, only for FR & FCR models 
#       
#       # set the caches for models to 0
#       # Plot with ggplot
#       p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
#                                 (model_type == "42" |model_type == "41" ), 
#                                 (env == 8 | env == 6)), 
#                   aes(y = value, x = timestep, col =  hoard_type)) +
#         geom_line(size = 0.75) +
#         facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
#         xlab("Days") +  
#         ylab("Value") +
#         scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                            labels = seq(0, 30, by = 5)) +     # Label every 5 days
#         vera_theme(bg = "white") +
#         scale_color_manual(values = ch6_col, 
#                            name = "Hoarding type", 
#                            labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
#         # scale_linetype_manual(name = "Energy proxy", 
#         #                       values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
#         #                       labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
#         guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
#                lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
#         theme(legend.position = "bottom") +  # Move legend to the bottom
#         geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#         geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
#       
#       p
#       
#       
#       # Save the plot with specified size and resolution
#       ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# 
# ################################
# # same but for non-hoarders    # 
# ################################
# ch6_col_nh<-c("#8C6511", "#FFBD30", "#D8C8A6")
# # Plot with ggplot
# p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"), 
#                           (model_type == "21"  | model_type == "31" |model_type== "41"), 
#                           (env == 8 | env == 6)), 
#             aes(y = value, x = timestep, col =  var_type)) +
#   geom_line(size = 0.75) +
#   facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
#   xlab("Days") +  
#   ylab("Value") +
#   scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                      labels = seq(0, 30, by = 5)) +     # Label every 5 days
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col_nh, 
#                      name = "", 
#                      labels = c("FR", "FCR", "FR & FCR")) +
#   theme(legend.position = "bottom") +  # Move legend to the bottom
#   geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#   geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
# 
# p
# 
# 
# # Save the plot with specified size and resolution
# ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 6, dpi = 500)  # Specify the size in inches and resolution

################################
# the same but for supplementary # 
##################################

ch6_col_sup<-c("#2E5F14", "#8DA27F", "#D1D2AC", "#DCDEB3", "#8DA27F", "#88CCEE")
# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" | id == "caches"), 
                          (model_type == "231"  | model_type == "331" |model_type== "431"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p


# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_phys_suppl_FigD1_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

# number 2 

ch6_col_sup<-c("#2E5F14", "#8DA27F", "#D1D2AC", "#DCDEB3", "#8DA27F", "#88CCEE")
# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" | id == "caches"), 
                          (model_type == "232"  | model_type == "332" |model_type== "432"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p


# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_phys_supll_FigD2_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution


####################################################################################################################################


# Now I want to average that across the days 

df_psych_sum<-df%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred, hoard_type, var_type)%>%
  summarise(mean_value = mean(value)) %>%
  ungroup()%>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id =="caches"~0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" |id == "caches"), (model_type == "22" |model_type == "32" |model_type =="42"|model_type == "21"  | model_type == "31" |model_type== "41"), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col =var_type, lty = hoard_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  
  scale_color_manual(values = ch6_col,
                     name = "Energy proxy", 
                                             labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed

  scale_linetype_manual(name = "Hoarding type",
                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop"),
                        values = c("solid", "dashed", "dotted", "dotdash" ))+  # Adjust linetypes as needed
  guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
    theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p

ggsave("ch6_phys_agg_Fig64_png.png", plot = p, width = 7.2, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg thesis 
ggsave("ch6_phys_agg_Fig64_svg.svg", plot = p, width = 7.2, height = 8, dpi = 500)  # Specify the size in inches and resolution
# 
# 
# # Now for teh FR models only 
#     p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" |id == "caches"), 
#                                       (model_type == "22" |model_type == "21"), (env == 8 | env == 6), timestep_within_day<=23), 
#            aes(y = mean_value, x = timestep_within_day, col =hoard_type)) +
#       geom_line(size = 0.75) +
#       facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
#       xlab("Timestep in day") +  # Change x-axis label to "Days"
#       ylab("Value")+
#       scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
#                          labels = seq(1, 8, by = 1)) +     # Label every 5 days
#       vera_theme(bg = "white") +
#       scale_color_manual(values = ch6_col, 
#                          name = "Hoarding type", 
#                          labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
#       scale_linetype_manual(name = "Energy proxy", 
#                             values = c("solid", "dashed", "dotted", "dotdash"),  # Adjust linetypes as needed
#                             labels = c("FR", "FCR", "FR & FCR")) +  # Update line type labels as needed
#       guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
#              lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
#       theme(legend.position = "bottom") +  # Move legend to the bottom
#       geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#       geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
#     
#     p
#     
#     ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

#################################
# the same for non-hoarders   ###
#################################
# p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"), (model_type == "21" |model_type == "31" |model_type =="41"), (env == 8 | env == 6), timestep_within_day<=23), 
#        aes(y = mean_value, x = timestep_within_day, col = model_type)) +
#   geom_line(size = 0.75) +
#   facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
#   xlab("Timestep in day") +  # Change x-axis label to "Days"
#   ylab("Value")+
#   scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
#                      labels = seq(1, 8, by = 1)) +     # Label every 5 days
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col_nh, 
#                      name = "", 
#                      labels = c("FR", "FCR", "FR & FCR")) +
#   theme(legend.position = "bottom")+  # Move legend to the bottom
#   geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
#   geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
# 
# p# Save the plot with specified size and resolution
# ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 6, dpi = 500)  # Specify the size in inches and resolution


###################################
# And for supplementary materials #
###################################

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"|id == "caches"), (model_type == "231" |model_type == "331" |model_type =="431"), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_phys_agg_supll_FigD3_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution


# number 2
p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"|id == "caches"), (model_type == "232" |model_type == "332" |model_type =="432"), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_phys_agg_supll_FigD4_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

```





###  chapter 6 Behaviour

```{r chapter 6 behaviour }
# Define a named vector for the new labels
id_labels <- c("rest" = "Rest", "eat" = "Eat", "eat_hoard" = "Eat & hoard",  "retrieve"="Retrieve" )

ch6_col<-c("#FFBD30", "#A06713", "#8DA27F", "#2E5F14")

ch6_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "eat_hoard"  |id =="retrieve"))%>%
  filter(model_type == "22" |model_type == "32" |model_type =="42")%>%
  filter((env == 8 | env == 6))%>%
  mutate(id = factor(id, levels = c("eat", "rest", "eat_hoard", "retrieve")))  # Set facet order
  
p<-ggplot(ch6_beh, 
       aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("ch6_beh_hoarders_Fig65_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for tehsis 
ggsave("ch6_beh_hoarders_Fig65_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

#########################################

# non hoarders 

ch6_beh<-df%>%
  filter((id == "rest" | id == "eat"))%>%
  filter(model_type =="21" |model_type =="31"|model_type == "41")%>%
  filter((env == 8 | env == 6))%>%
  mutate(id = factor(id, levels = c("eat", "rest", "eat_hoard", "retrieve")))  # Set facet order
  
p<-ggplot(ch6_beh, 
       aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col, 
                     name = "", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("ch6_beh_nonh_Fig66_png.png", plot = p, width = 7, height = 5, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_beh_nonh_Fig66_svg.svg", plot = p, width = 7, height = 5, dpi = 500)  # Specify the size in inches and resolution

#################################
# The same for the non-hoarders # 
##################################
# 
# ch6_beh<-df%>%
#   filter((id == "rest" | id == "eat" ))%>%
#   filter( model_type == "21"  | model_type == "31" |model_type== "41")%>%
#   filter((env == 8 | env == 6))
#   
# p<-ggplot(ch6_beh, 
#        aes(y = value, x = timestep, col = var_type)) +
#   geom_line(size = 0.75) +
#   facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
#   xlab("Days") +  # Change x-axis label to "Days"
#   ylab("Value")+
#   scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
#                      labels = seq(0, 30, by = 5)) +     # Label every 5 days
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col_nh, 
#                      name = "", 
#                      labels = c("FR", "FCR", "FR & FCR")) +
#   theme(legend.position = "bottom")  # Move legend to the bottom
# 
# # Save the plot with specified size and resolution
# ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 5, dpi = 500)  # Specify the size in inches and resolution

###############################
# for supplemnetary materials #
###############################
id_labels <- c("rest" = "Rest", "eat" = "Eat", "dir_hoard" = "Hoard",  "retrieve"="Retrieve" )
ch6_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve"))%>%
  filter(model_type == "231" |model_type == "331" |model_type =="431")%>%
  filter((env == 8 | env == 6))

p<-ggplot(ch6_beh,
       aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col,
                     name = "",
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
#svg for thesis 
ggsave("ch6_beh_suppl_FigD5_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution


# number 2

ch6_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve"))%>%
  filter(model_type == "232" |model_type == "332" |model_type =="432")%>%
  filter((env == 8 | env == 6))

p<-ggplot(ch6_beh,
       aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col,
                     name = "",
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_beh_supll_FigD6_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution


############################################################################################################################################################

# # Set the order of facets for `id`
# ch6_beh <- df %>%
#   filter(timestep >= 216) %>%
#   filter(id %in% c("rest", "eat", "eat_hoard", "retrieve")) %>%
#   filter(model_type %in% c("22", "32", "42", "21", "31", "41")) %>%
#   filter(env %in% c(2,4,8, 6)) %>%
#   mutate(id = factor(id, levels = c("eat", "rest", "eat_hoard", "retrieve")))  # Set facet order
# 
# # Summarise the data
# df_beh_sum <- ch6_beh %>%
#   group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type) %>%
#   summarise(mean_value = mean(value), .groups = 'drop')
# 
# # Plot
# p <- ggplot(df_beh_sum %>% 
#               filter(id %in% c("rest", "eat", "eat_hoard", "retrieve"), 
#                      model_type %in% c("22", "32", "42", "21", "31", "41"), 
#                      env %in% c(2,4), 
#                      timestep_within_day <= 23), 
#             aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
#   geom_line(size = 0.75) +
#   facet_grid(vars(id), vars(env), labeller = labeller(id = id_labels)) +  # Rename facet labels
#   xlab("Hour in day") +
#   ylab("Value") +
#   scale_x_continuous(breaks = seq(0, 23, by = 3), labels = seq(1, 8, by = 1)) +
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col,
#                      name = "Energy proxy", 
#                      labels = c("FR", "FCR", "FR & FCR")) +
#   scale_linetype_manual(name = "Hoarding type",
#                         labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop"),
#                         values = c("solid", "dashed", "dotted", "dotdash")) +
#   theme(legend.position = "bottom")  # Move legend to the bottom
# 
# p
# 
# # Plot
# p <- ggplot(df_beh_sum %>% 
#               filter(id %in% c("rest", "eat", "eat_hoard", "retrieve"), 
#                      model_type %in% c("22", "32", "42", "21", "31", "41"), 
#                      env %in% c(6,8), 
#                      timestep_within_day <= 23), 
#             aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
#   geom_line(size = 0.75) +
#   facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
#   xlab("Hour in day") +
#   ylab("Value") +
#   scale_x_continuous(breaks = seq(0, 23, by = 3), labels = seq(1, 8, by = 1)) +
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col,
#                      name = "Energy proxy", 
#                      labels = c("FR", "FCR", "FR & FCR")) +
#   scale_linetype_manual(name = "Hoarding type",
#                         labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop"),
#                         values = c("solid", "dashed", "dotted", "dotdash")) +
#   theme(legend.position = "bottom")  # Move legend to the bottom
# 
# p
# 
# p# Save the plot with specified size and resolution
# ggsave("standardized_plot_beh.png", plot = p, width = 7.2, height = 7, dpi = 500)  # Specify the size in inches and resolution

#################################
# for the non-hoarders          #
#################################
# ch6_beh<-df%>%
#   filter(timestep>=216)%>%
#   filter((id == "rest" | id == "eat" | id == "eat_hoard"  |id =="retrieve"))%>%
#   filter(model_type == "21" |model_type == "31" |model_type =="41")%>%
#   filter((env == 8 | env == 6))
# df_beh_sum<-ch6_beh%>%
#   group_by(id, env, timestep_within_day, model_type, food_pred)%>%
#   summarise(mean_value = mean(value))%>%
#   ungroup()
# p<-ggplot(df_beh_sum %>% filter((id == "rest" | id == "eat" ), (model_type == "21" |model_type == "31" |model_type =="41"), (env == 8 | env == 6), timestep_within_day<=23), 
#        aes(y = mean_value, x = timestep_within_day, col = model_type)) +
#   geom_line(size = 0.75) +
#   facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
#   xlab("Timestep in day") +  # Change x-axis label to "Days"
#   ylab("Value")+
#   scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
#                      labels = seq(1, 8, by = 1)) +     # Label every 5 days
#   vera_theme(bg = "white") +
#   scale_color_manual(values = ch6_col_nh, 
#                      name = "", 
#                      labels = c("FR", "FCR", "FR & FCR")) +
#   theme(legend.position = "bottom")#+  # Move legend to the bottom
#   #xlim(0, 24)
# 
# p# Save the plot with specified size and resolution
# ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 5, dpi = 500)  # Specify the size in inches and resolution
# 
# ###########################
# # supplementary materials #
###########################
# Now I want to average that across the days
id_labels <- c("rest" = "Rest", "eat" = "Eat", "dir_hoard" = "Hoard",  "retrieve"="Retrieve" )
ch6_beh<-df%>%
  filter(timestep>=216)%>%
  filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve"))%>%
  filter(model_type == "231" |model_type == "331" |model_type =="431")%>%
  filter((env == 8 | env == 6))
df_beh_sum<-ch6_beh%>%
  group_by(id, env, timestep_within_day, model_type, food_pred)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve"),
                                (model_type == "231" |model_type == "331" |model_type =="431"), (env == 8 | env == 6), timestep_within_day<=23),
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col,
                     name = "",
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")#+  # Move legend to the bottom
  #xlim(0, 24)

p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_beh_agg_supl_FigD7_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# number 2

# Now I want to average that across the days
id_labels <- c("rest" = "Rest", "eat" = "Eat", "dir_hoard" = "Hoard",  "retrieve"="Retrieve" )
ch6_beh<-df%>%
  filter(timestep>=216)%>%
  filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve"))%>%
  filter(model_type == "232" |model_type == "332" |model_type =="432")%>%
  filter((env == 8 | env == 6))
df_beh_sum<-ch6_beh%>%
  group_by(id, env, timestep_within_day, model_type, food_pred)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve"),
                                (model_type == "232" |model_type == "332" |model_type =="432"), (env == 8 | env == 6), timestep_within_day<=23),
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col,
                     name = "",
                     labels = c("FR", "FCR", "FR & FCR")) +
  theme(legend.position = "bottom")#+  # Move legend to the bottom
  #xlim(0, 24)

p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch6_beh_agg_supl_FigD8_svg.svg", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

```



### Ch6 effects of temp and food 

So what happens when we lower the temperature and food availability? 

```{r ch6 lower food avail}


# Reorder env levels and rename them
df <- df %>%
  mutate(env3 = factor(env, levels = c(6, 8, 5, 7, 2, 4, 1, 3, 10, 12, 9, 11),
                      labels = c("Poisson", "Bonanza", "Poisson low temperature", "Bonanza low temperature", 
                                 "Poisson low food", "Bonanza low food", "Poisson low food + low temperature", "Bonanza low food + low temperature", "10", "12", "9", "11")))

# Plot with ggplot
p <- ggplot(df %>% filter(id == "alive",(model_type == "22" |model_type == "32" |model_type =="42"| model_type =="21"|model_type =="31"|model_type=="41") , (env ==6 | env == 8 | env == 2 | env == 4| env == 5 | env == 7 | env ==1 | env==3)), 
            aes(y = value, x = timestep, col = var_type, lty = hoard_type)) +
  geom_line(size = 1) +
  facet_wrap(~ env3, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch6_col,
                     name = "Energy proxy", 
                     labels = c("FR", "FCR", "FR & FCR")) +
  scale_linetype_manual(name = "Hoarding type",
                        labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop"),
                        values = c("solid", "dashed", "dotted", "dotdash")) +
  theme(legend.position = "bottom")

p

# Save the plot with specified size and resolution
ggsave("ch6_environments_png.png", plot = p, width = 7.5, height = 8, dpi = 500)  # Specify the size in inches and resolution
# svg thesis 
ggsave("ch6_environments_svg.svg", plot = p, width = 7.5, height = 8, dpi = 500)  # Specify the size in inches and resolution

```




## Chapter 7

### Survival chapter 7

```{r graphs chapter survival 7}
#ch4_col<-c("#AA4499", "#DDCC77", "#44AA99", "#332288")
ch7_col<-c("#6FA254", "#CA5D05")


## survival across environment 5 and 6 
p <- ggplot(df %>% filter(id == "alive", (var_type == "5" | var_type == "6"), (env == 8 | env == 6)), 
            aes(y = value, x = timestep, lty = hoard_type, col = var_type)) +
  geom_line(size = 0.75) +
  facet_wrap(~food_pred, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch7_col, 
                     name = "Energy proxies",
                     labels = c("SC & FR", "SC & FCR")
                     
                     ) +
  scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed", "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +  # Update line type labels as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type
p


# Save the plot with specified size and resolution
ggsave("standardized_plot_surv.png", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution

ggsave("ch7_surv_svg.svg", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution

ch7_col<-c("#2E5F14", "#6FA254","#a24b04", "#DD975E")
# do a graph where I show 12 environment survival 
p<-ggplot(df%>%filter(model_type =="531"|model_type =="532"|model_type=="631"|model_type=="632", id =="alive"), 
       aes(x = timestep, y = value, lty = hoard_type, col = var_type))+
  geom_line(size = 0.75) +
  facet_wrap(~env, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  vera_theme(bg = "white")+
   scale_color_manual(values = ch7_col, 
                     name = "Energy proxies",
                     labels = c("SC & FR", "SC & FCR")
                     
                     ) +
  scale_linetype_manual( name = "Hoarding type", 
                        values = c("dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Direct hoarding Htop", "Direct hoarding Rtop")) + # Update line type
   theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line typelabels as needed

# Save the plot with specified size and resolution
ggsave("standardized_plot_surv.png", plot = p, width = 7, height = 10, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch7_supp_surv_12_env_svg.svg", plot = p, width = 7, height = 10, dpi = 500) 

```

###  chapter 7 physiology 
```{r chapter 7 physiology }
# take the yekllow for non-hoarders out
ch7_col<-c("#2E5F14", "#6FA254","#a24b04", "#DD975E")

ch7_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"))%>%
  filter((env==6)|env==8)%>%
  filter(chapter ==7)


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))


# Add a column for y-axis limits based on 'id'
df <- df %>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" |id =="caches"), 
                          (model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Leftover hoarding", "SC & FR - Direct hoarding Rtop", "SC & FCR - Leftover hoarding", "SC & FCR - Direct hoarding Rtop"))+  # Adjust linetypes as needed

  guides(col = guide_legend(order = 1, nrow = 4),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom", legend.direction = "horizontal") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits


p


# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# save svg for thesis 
ggsave("ch7_phys_hoarders_svg.svg", plot = p, width = 7, height = 8, dpi = 500)

############################
# same for the non-hoarders 
#############################
# take the yekllow for non-hoarders out
ch7_col<-c("#6FA254", "#CA5D05")

ch7_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"))%>%
  filter((env==6)|env==8)%>%
  filter(chapter ==7)


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))


# Add a column for y-axis limits based on 'id'
df <- df %>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"), 
                          (model_type == "51" |model_type == "61"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Non-hoarder" ,"SC & FCR - Non-hoarder")) +
    theme(legend.position = "bottom",  # Move legend to the bottom
        legend.direction = "vertical",  # Stack legend items vertically
        legend.title = element_text(size = 10),  # Set the font size for the legend title
        legend.text = element_text(size = 8)) +
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p


# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height =6, dpi = 500)  # Specify the size in inches and resolution
# save svg for thesis 
ggsave("ch7_phys_nonH_svg.svg", plot = p, width = 7, height =6, dpi = 500)


####################################################################################
# Now I want to average that across the days 

ch7_col<-c("#6FA254", "#CA5D05")
df_psych_sum<-df%>%
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value)) %>%
  ungroup()%>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id =="caches"), (model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632"|model_type =="51"|model_type =="61"), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
   scale_color_manual(values = ch7_col,
                     name = "Energy proxy", 
                                             labels = c("SC & FR", "SC & FCR" )) +  # Update line type labels as needed

  scale_linetype_manual(name = "Hoarding type",
                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Rtop"),
                        values = c("solid", "dashed", "dotted", "dotdash" ))+  # Adjust linetypes as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))+  # Second row for line type
    geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch7_phys_agg_svg.svg", plot = p, width = 7, height = 7, dpi = 500)
########################################################################################################################################



# supplementary 

# take the yekllow for non-hoarders out
ch7_col<-c("#6FA254", "#CA5D05")

ch7_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"))%>%
  filter((env==6)|env==8)%>%
  filter(chapter ==7)


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))


# Add a column for y-axis limits based on 'id'
df <- df %>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r" |id =="caches"), 
                          (model_type == "531" |model_type == "631"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col =  model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Direct-hoarding (Htop)", "SC & FCR - Direct hoarding (Htop)"))+  # Adjust linetypes as needed

  guides(col = guide_legend(order = 1, nrow = 4),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom", legend.direction = "horizontal") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits


p


# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# Svg for thesis 
ggsave("ch7_supp_figureE2_svg.svg", plot = p, width = 7, height = 8, dpi = 500) 


# supplementary across the days 

# Now I want to average that across the days 

ch7_col<-c("#6FA254", "#CA5D05")
df_psych_sum<-df%>%
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value)) %>%
  ungroup()%>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id =="caches"), (model_type == "531" |model_type == "631" ), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
 scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Direct-hoarding (Htop)", "SC & FCR - Direct hoarding (Htop)"))+  # Adjust linetypes as needed

  guides(col = guide_legend(order = 1, nrow = 4),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom", legend.direction = "horizontal") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch7_supp_phys_agg_svg.svg", plot = p, width = 7, height = 7, dpi = 500)
```

###  chapter 7 Behaviour

```{r chapter 7 behaviour }
ch7_col<-c("#2E5F14", "#6FA254","#a24b04", "#DD975E")
# Define a named vector for the new labels
id_labels <- c("rest" = "Rest", "eat" = "Eat", "eat_hoard" = "Eat & hoard",  "dir_hoard" = "Direct hoard", "retrieve"="Retrieve" )


ch7_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "eat_hoard"  |id =="retrieve"|id == "dir_hoard"))%>%
  filter(model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632")%>%
  filter((env == 8 | env == 6))%>%
  mutate(id = factor(id, levels = c("eat", "rest", "eat_hoard","dir_hoard", "retrieve")))  # Set facet order
  
p<-ggplot(ch7_beh, 
       aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  vera_theme(bg = "white")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Leftover hoarding", "SC & FR - Direct hoarding Rtop", "SC & FCR - Leftover hoarding", "SC & FCR - Direct hoarding Rtop"))+  # Adjust linetypes as needed

  guides(col = guide_legend(order = 1, nrow = 4),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom", legend.direction = "horizontal") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 9, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis
ggsave("ch7_beh_hoarders_svg.svg", plot = p, width = 7, height = 9, dpi = 500)

###################################################################################################

# same for non-hoarers 
ch7_col<-c("#6FA254", "#CA5D05")
# Define a named vector for the new labels
id_labels <- c("rest" = "Rest", "eat" = "Eat", "eat_hoard" = "Eat & hoard",  "dir_hoard" = "Direct hoard", "retrieve"="Retrieve" )


ch7_beh<-df%>%
  filter((id == "rest" | id == "eat" ))%>%
  filter(model_type == "51" |model_type == "61")%>%
  filter((env == 8 | env == 6))%>%
  mutate(id = factor(id, levels = c("eat", "rest", "eat_hoard","dir_hoard", "retrieve")))  # Set facet order
  
p<-ggplot(ch7_beh, 
       aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  vera_theme(bg = "white")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
        theme(legend.position = "bottom",  # Move legend to the bottom
        legend.direction = "vertical",  # Stack legend items vertically
        legend.title = element_text(size = 10),  # Set the font size for the legend title
        legend.text = element_text(size = 8)) +
  scale_color_manual(values = ch7_col, 
                     name = "", 
                     labels = c("SC & FR - Non-hoarding" ,"SC & FCR - Non-hoarding")) +
  theme(legend.position = "bottom")  # Move legend to the bottom

# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 5, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch7_beh_nonH_svg.svg", plot = p, width = 7, height = 5, dpi = 500)

###################################################################################################

# Now I want to average that across the days 
ch7_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "eat_hoard"  |id =="retrieve"|id == "dir_hoard"))%>%
  filter(model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632"| model_type =="51" |model_type =="61")%>%
  filter((env == 8 | env == 6))
df_beh_sum<-ch7_beh%>%
    mutate(id = case_when(
    id == "eat_hoard" ~ "Hoard", 
    id == "dir_hoard" ~ "Hoard", 
    TRUE ~ id
  )) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "Hoard", "retrieve"))) %>% # Set the order of facets
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter((id == "rest" | id == "eat" | id == "Hoard"  |id =="retrieve" ), (model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632"|model_type == "51"| model_type =="61"), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 time steps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
   scale_color_manual(values = ch7_col,
                     name = "Energy proxy", 
                                             labels = c("SC & FR", "SC & FCR" )) +  # Update line type labels as needed

  scale_linetype_manual(name = "Hoarding type",
                     labels = c("Non hoarding", "Leftover hoarding",  "Direct hoarding Rtop"),
                        values = c("solid", "dashed", "dotted", "dotdash" ))+  # Adjust linetypes as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type

p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
#svg for thesis 
ggsave("ch7_beh_aggregated_svg.svg", plot = p, width = 7, height = 8, dpi = 500)

###############################################################################

# supplementary 
ch7_col<-c("#6FA254", "#CA5D05")
# Define a named vector for the new labels
id_labels <- c("rest" = "Rest", "eat" = "Eat", "dir_hoard" = "Direct hoard", "retrieve"="Retrieve" )
# Now I want to average that across the days 


ch7_beh<-df%>%
  filter((id == "rest" | id == "eat" |id =="retrieve"|id == "dir_hoard" | id =="Hoard"|id == "hoard"))%>%
  filter(model_type == "531" |model_type == "631")%>%
  filter((env == 8 | env == 6))
  
p<-ggplot(ch7_beh, 
       aes(y = value, x = timestep, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value")+
  vera_theme(bg = "white")+
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Direct-hoarding (Htop) ", "SC & FR - Direct hoarding (Htop)"))+  # Adjust linetypes as needed

  guides(col = guide_legend(order = 1, nrow = 4),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom", legend.direction = "horizontal") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch7_supp_fig_E4_svg.svg", plot = p, width = 7, height = 8, dpi = 500)

###############################################################################

# supplemntary daily aggregate

id_labels <- c("rest" = "Rest", "eat" = "Eat", "dir_hoard" = "Direct hoard", "retrieve"="Retrieve" )
# Now I want to average that across the days 
ch7_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "eat_hoard"  |id =="retrieve"|id == "dir_hoard"))%>%
  filter(model_type == "531" |model_type == "631" )%>%
  filter((env == 8 | env == 6))

df_beh_sum<-ch7_beh%>%
  mutate(id = factor(id, levels = c("eat", "rest", "dir_hoard", "retrieve"))) %>% # Set the order of facets
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type, y_min, y_max)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter((id == "rest" | id == "eat" | id == "dir_hoard"  |id =="retrieve" ), (model_type == "531" |model_type == "631" ), (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
 scale_color_manual(values = ch7_col,
                     name = "",
                     labels = c("SC & FR - Direct-hoarding (Htop)", "SC & FCR - Direct hoarding (Htop)"))+  # Adjust linetypes as needed

  guides(col = guide_legend(order = 1, nrow = 4),  # First row for color
         lty = guide_legend(order = 2, nrow = 1)) + # Second row for line type
  theme(legend.position = "bottom", legend.direction = "horizontal")+   # Move legend to the bottom
    geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits
p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
#svg for thesis 
ggsave("ch7_supp_fig_E5_svg.svg", plot = p, width = 7, height = 8, dpi = 500)


```

### Ch7 effects of temp and food 

So what happens when we lower the temperature and food availability? 

```{r ch7 lower food avail}


# Reorder env levels and rename them
df <- df %>%
  mutate(env3 = factor(env, levels = c(6, 8, 5, 7, 2, 4, 1, 3, 10, 12, 9, 11),
                      labels = c("Poisson", "Bonanza", "Poisson low temperature", "Bonanza low temperature", 
                                 "Poisson low food", "Bonanza low food", "Poisson low food + low temperature", "Bonanza low food + low temperature", "10", "12", "9", "11")))

# Plot with ggplot
p <- ggplot(df %>% filter(id == "alive",(model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632"|model_type =="51"|model_type =="61") , (env ==6 | env == 8 | env == 2 | env == 4| env == 5 | env == 7 | env ==1 | env==3)), 
            aes(y = value, x = timestep, col = var_type, lty = hoard_type)) +
  geom_line(size = 1) +
  facet_wrap(~ env3, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
   scale_color_manual(values = ch7_col,
                     name = "Energy proxy", 
                                             labels = c("SC & FR", "SC & FCR" )) +  # Update line type labels as needed

  scale_linetype_manual(name = "Hoarding type",
                     labels = c("Non hoarding", "Leftover hoarding",  "Direct hoarding Rtop"),
                        values = c("solid", "dashed", "dotted", "dotdash" ))+  # Adjust linetypes as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type
p

# Save the plot with specified size and resolution
ggsave("standardized_plot_surv_temp_food.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution

```


## Chapter 8 Discussion 

### Chapter 8: comparing the non-hoarders 

```{r compare non hoarders }

non_h_col<-c("#283F80", "#FFBD30", "#A06713","#8DA27F", "#238242", "#CA5D05")
## survival across environment 5 and 6 
p <- ggplot(df %>% filter(id == "alive", 
                          (model_type == "11" | model_type =="21" | model_type =="31" | model_type =="41" | model_type =="51" | model_type =="61"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75) +
  facet_wrap(~food_pred, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = non_h_col,
                     name = "Energy proxies",
                     labels = c("SC", "FR", "FCR", "FR & FCR", "SC & FR", "SC & FCR")

                     ) +
  # scale_linetype_manual( name = "Hoarding type", 
  #                       values = c("solid", "dashed", "dotdash", "dotted"),  # Adjust linetypes as needed
  #                       labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +  # Update line type labels as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type
p


################################### LEFTOVER HOARDERS SURVIVAL ############################################

p <- ggplot(df %>% filter(id == "alive", 
                          (model_type == "12" | model_type =="22" | model_type =="32" | model_type =="42" | model_type =="52" | model_type =="62"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75) +
  facet_wrap(~food_pred, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = non_h_col,
                     name = "Energy proxies",
                     labels = c("SC", "FR", "FCR", "FR & FCR", "SC & FR", "SC & FCR")

                     ) +
  # scale_linetype_manual( name = "Hoarding type", 
  #                       values = c("solid", "dashed", "dotdash", "dotted"),  # Adjust linetypes as needed
  #                       labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +  # Update line type labels as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type
p


# Save the plot with specified size and resolution
ggsave("ch8.png", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch8_svg.svg", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution

################################### direct HOARDERS SURVIVAL ############################################
non_h_col3<-c( "#238242", "#CA5D05")
p <- ggplot(df %>% filter(id == "alive", 
                          ( model_type =="532" | model_type =="632"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75) +
  facet_wrap(~food_pred, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = non_h_col3,
                     name = "Energy proxies",
                     labels = c("SC & FR", "SC & FCR")

                     ) +
  scale_linetype_manual( name = "Hoarding type",
                        values = c( "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c( "Direct hoarding Htop", "Direct hoarding Rtop")) +  # Update line type labels as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type
p


# Save the plot with specified size and resolution
ggsave("ch8.png", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution
ggsave("ch8_svg.svg", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution
################################### direct HOARDERS retrieval ############################################
non_h_col3<-c( "#238242", "#CA5D05")
p <- ggplot(df %>% filter(id == "retrieve", 
                          ( model_type =="532" | model_type =="632")), 
            aes(y = value, x = timestep, col = var_type)) +
  geom_line(size = 0.75) +
  facet_wrap(~env, ncol = 2) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = non_h_col3,
                     name = "Energy proxies",
                     labels = c("SC & FR", "SC & FCR")

                     ) +
  scale_linetype_manual( name = "Hoarding type",
                        values = c( "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c( "Direct hoarding Htop", "Direct hoarding Rtop")) +  # Update line type labels as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type
p


# Save the plot with specified size and resolution
ggsave("ch8.png", plot = p, width = 7, height = 4, dpi = 500)  # Specify the size in inches and resolution
#############################################################################################################################

non_h_col2<-c("#283F80", "#238242", "#CA5D05")

ch8_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"))%>%
  filter((env==6)|env==8)


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))

df_psych_sum<-df%>%
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value)) %>%
  ungroup()%>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"), 
                                  (model_type == "11" | model_type =="51" | model_type =="61"), 
                                  (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
   scale_color_manual(values = non_h_col2,
                     name = "Energy proxy", 
                                             labels = c("SC", "SC & FR", "SC & FCR")) +  # Update line type labels as needed
# 
#   scale_linetype_manual(name = "Hoarding type",
#                      labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Rtop"),
#                         values = c("solid", "dashed", "dotted", "dotdash" ))+  # Adjust linetypes as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))+  # Second row for line type
    geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p# Save the plot with specified size and resolution
ggsave("standardized_plot_psych.png", plot = p, width = 7, height = 6, dpi = 500)  # Specify the size in inches and resolution

#####################################################################################################################################

# Now I want to average that across the days 
ch8_beh<-df%>%
  filter((id == "rest"))%>%
  filter(model_type == "531" | model_type =="532" | model_type =="631"| model_type =="632")
df_beh_sum<-ch8_beh%>%
    mutate(id = case_when(
    id == "eat_hoard" ~ "Hoard", 
    id == "dir_hoard" ~ "Hoard", 
    TRUE ~ id
  )) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "Hoard", "retrieve"))) %>% # Set the order of facets
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()

#####################################

p<-ggplot(df_beh_sum %>% filter((id == "rest"), (model_type == "531" | model_type =="532" | model_type =="631"| model_type =="632"), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75) +
  facet_wrap(~env, ncol=2) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 time steps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  #  scale_color_manual(values = non_h_col2,
  #                    name = "Energy proxy", 
  #                                            labels = c("SC", "SC & FR", "SC & FCR" )) +  # Update line type labels as needed
  # 
  # # scale_linetype_manual(name = "Hoarding type",
  # #                    labels = c("Non hoarding", "Leftover hoarding",  "Direct hoarding Rtop"),
  #                       values = c("solid", "dashed", "dotted", "dotdash" ))+  # Adjust linetypes as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type

p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 5, dpi = 500)  # Specify the size in inches and resolution


```


### Chapter 8: comparing the hoarders: hoard & retrieve 

```{r compare teh hoarders hoard and retrieve}

id_labels <- c("rest" = "Rest", "eat" = "Eat", "hoard" = "Hoard", "dir_hoard"="Hoard", "retrieve"="Retrieve" )

# Now I want to average that across the days 
ch8_beh<-df%>%
  filter((id == "rest" | id == "eat" | id == "eat_hoard"  |id =="retrieve"|id == "dir_hoard"))%>%
  filter(model_type == "12" |model_type == "22"| model_type =="32"|model_type =="42"|model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632")%>%
  filter((env == 8 | env == 6))
df_beh_sum<-ch8_beh%>%
    mutate(id = case_when(
    id == "eat_hoard" ~ "Hoard", 
    id == "dir_hoard" ~ "Hoard", 
    TRUE ~ id
  )) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "Hoard", "retrieve"))) %>% # Set the order of facets
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter((id == "rest" | id == "eat" | id == "Hoard"  |id =="retrieve" ), 
                                (model_type == "12" |model_type == "22"| model_type =="32"|model_type =="42"|model_type == "52" |model_type == "62" |model_type =="532"|model_type =="632"), 
                                (env == 8 | env == 6), timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 time steps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
   scale_color_manual(values = non_h_col,
                     name = "Energy proxy", 
                                             labels = c("SC", "FR", "FCR", "FR & FCR", "SC & FR", "SC & FCR")) +  # Update line type labels as needed

  scale_linetype_manual(name = "Hoarding type",
                     labels = c( "Leftover hoarding",  "Direct hoarding Rtop"),
                        values = c("dashed", "dotted"))+  # Adjust linetypes as needed
 theme(legend.position = "bottom",  # Move legend to the bottom
        legend.box = "vertical",   # Arrange legend items horizontally
        legend.box.just = "left") +  # Center the legend box
    guides(col = guide_legend(order = 1, nrow = 1),  # First row for color
         lty = guide_legend(order = 2, nrow = 1))  # Second row for line type

p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution





```


##### Thesis 

```{r thesis presentation grahs }

viva_col<-c( "#A8BCC6", "red","#3F8069", "#8DA27F", "#88CCEE")
## survival across environment 6 and 8
p<-ggplot(df %>% filter(id == "alive", (env == 8 | env == 6), (model_type == "11"|model_type=="12"|model_type=="41"|model_type=="42")), 
       aes(y = value, x = timestep, lty = hoard_type, col = var_type)) +
  geom_line(size = 1) +
  facet_wrap(~food_pred, ncol = 1) +
  ylim(0, 1) +
  ylab("Proportion of birds alive") +
  xlab("Days") +  # Change x-axis label to "Days"
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed",  "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  scale_color_manual(values = viva_col,
                     name = "Variable type",
                     labels = c("Stomach content", "Fat reserve", "Direct-hoarding Htop", "Direct-hoarding Rtop"))
p

ggsave("viva_survival_png.png", plot = p, width = 6.5, height = 7, dpi = 500)  # Specify the size in inches and resolution

############################################


viva_phys<-df%>%
 filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id=="caches"))%>%
  filter((env==6)|env==8)%>%
  filter(model_type == "11"|model_type=="12"|model_type=="41"|model_type=="42")


# Define a named vector for the new labels
id_labels <- c("stom_con" = "SC", "fat_res" = "FR", "fat_loss_r" = "FCR", "caches" = "Caches")

# Ensure 'id' is a factor with the desired order
df$id <- factor(df$id, levels = c("stom_con", "fat_res", "fat_loss_r", "mass", "alive", "sleep", "rest", "forage","eat", "eat_hoard", "dir_hoard", "retrieve","find_food", "predation", "caches", "cache_decay", "temp"))


# Add a column for y-axis limits based on 'id'
df <- df %>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 75
  ))

# Plot with ggplot
p <- ggplot(df %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), 
                          (model_type == "11"|model_type=="12"|model_type=="41"|model_type=="42"), 
                          (env == 8 | env == 6)), 
            aes(y = value, x = timestep, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Free y-axis scales
  xlab("Days") +  
  ylab("Value") +
  scale_x_continuous(breaks = seq(0, 2160, by = 360),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 30, by = 5)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed",  "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  scale_color_manual(values = viva_col,
                     name = "Variable type",
                     labels = c("Stomach content", "Fat reserve", "Direct-hoarding Htop", "Direct-hoarding Rtop"))+
  theme(legend.position = "bottom") +  # Move legend to the bottom
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))    # Add invisible points to set y_max limits

p


# Save the plot with specified size and resolution
#ggsave("ch5_phys_Fig52_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution
####################################################



# Now I want to average that across the days 

df_psych_sum<-df%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value)) %>%
  ungroup()%>%
  mutate(y_min = case_when(
    id == "stom_con" ~ 0,
    id == "fat_res" ~ 0,
    id == "fat_loss_r" ~ -0.3, 
    id == "caches" ~ 0
  ),
  y_max = case_when(
    id == "stom_con" ~ 0.4,
    id == "fat_res" ~ 4,
    id == "fat_loss_r" ~ 0.3, 
    id == "caches" ~ 25
  ))

p<-ggplot(df_psych_sum %>% filter((id == "fat_res" | id == "stom_con" | id == "fat_loss_r"| id == "caches"), (model_type == "11"|model_type=="12"|model_type=="41"|model_type=="42"), (env == 8 | env == 6), timestep_within_day<=24), 
       aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred), scales = "free_y", labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 23, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(1, 8, by = 1)) +     # Label every 5 days
  # vera_theme(bg = "white") +
 scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed",  "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  scale_color_manual(values = viva_col,
                     name = "Variable type",
                     labels = c("Stomach content", "Fat reserve", "Direct-hoarding Htop", "Direct-hoarding Rtop"))+
  geom_blank(aes(y = y_min)) +  # Add invisible points to set y_min limits
  geom_blank(aes(y = y_max))+    # Add invisible points to set y_max limits
  vera_theme(bg = "white")+
  theme(legend.position = "bottom")  # Move legend to the bottom

p# Save the plot with specified size and resolution
ggsave("viva_phys_png.png", plot = p, width = 7, height = 7, dpi = 500)  # Specify the size in inches and resolution

###################################################################

# Define a named vector for the new labels
id_labels <- c("rest" = "Rest", "eat" = "Eat", "hoard" = "Hoard", "dir_hoard"="Hoard", "retrieve"="Retrieve" )

viva_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter((model_type == "11"|model_type=="12"|model_type=="41"|model_type=="42")) %>%
  filter(env %in% c(8, 6)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

p <- ggplot(viva_beh, 
            aes(y = value, x = timestep, col = var_type, lty=hoard_type)) +
  geom_line(size = 0.75, alpha = 0.5) +
  facet_grid(vars(id), vars(food_pred), labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Days") +  # Change x-axis label to "Days"
  ylab("Value") +
 scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed",  "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  scale_color_manual(values = viva_col,
                     name = "Variable type",
                     labels = c("Stomach content", "Fat reserve", "Direct-hoarding Htop", "Direct-hoarding Rtop"))+
  vera_theme(bg = "white") +
  scale_color_manual(values = viva_col, 
                     name = "", 
                     labels = c("Non-hoarding", "Leftover-hoarding")) +
  theme(legend.position = "bottom")  # Move legend to the bottom


#######################################################################################################################

#######################################################################################################################


df_beh_sum<-viva_beh%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred, var_type, hoard_type)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter(timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = var_type, lty = hoard_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_linetype_manual( name = "Hoarding type", 
                        values = c("solid", "dashed",  "dotdash", "dotted"),  # Adjust linetypes as needed
                        labels = c("Non-hoarding", "Leftover-hoarding", "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  scale_color_manual(values = viva_col,
                     name = "Variable type",
                     labels = c("Stomach content", "Fat reserve", "Direct-hoarding Htop", "Direct-hoarding Rtop"))+
  vera_theme(bg = "white") +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  ylim(0,1)


p# Save the plot with specified size and resolution
ggsave("viva_beh_png.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution

################################################################################################################

## supplemnetary for direct-hoarders ####


# Now I want to average that across the days 
ch5_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c("131", "132")) %>%
  filter(env %in% c(8, 6)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

df_beh_sum<-ch5_beh%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type, food_pred)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()



p<-ggplot(df_beh_sum %>% filter(timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(food_pred),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 24, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c( "Direct-hoarding Htop", "Direct-hoarding Rtop")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  ylim(0,1)


p# Save the plot with specified size and resolution
ggsave("standardized_plot_beh.png", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution
# svg for thesis 
ggsave("ch5_beh_agg_supll_FigC4_svg.svg", plot = p, width = 7, height = 8, dpi = 500)  # Specify the size in inches and resolution








################################################################################################################

ch5_beh <- df %>%
  mutate(id = case_when(
    id == "eat_hoard" ~ "hoard", 
    id == "dir_hoard" ~ "hoard", 
    TRUE ~ id
  )) %>%
  filter(id %in% c("rest", "eat", "hoard", "retrieve")) %>%
  filter(model_type %in% c("11", "12", "131", "132")) %>%
  filter(env %in% c(2,4)) %>%
  mutate(id = factor(id, levels = c("eat", "rest", "hoard", "retrieve")))  # Set the order of facets

df_beh_sum<-ch5_beh%>%
  filter(timestep>=216)%>%
  group_by(id, env, timestep_within_day, model_type)%>%
  summarise(mean_value = mean(value))%>%
  ungroup()

p<-ggplot(df_beh_sum %>% filter(timestep_within_day<=23), 
       aes(y = mean_value, x = timestep_within_day, col = model_type)) +
  geom_line(size = 0.75) +
  facet_grid(vars(id), vars(env),  labeller = labeller(id = id_labels)) +  # Rename facet labels
  xlab("Hour in day") +  # Change x-axis label to "Days"
  ylab("Value")+
  scale_x_continuous(breaks = seq(0, 24, by = 3),   # Set breaks every 360 timesteps (5 days)
                     labels = seq(0, 8, by = 1)) +     # Label every 5 days
  vera_theme(bg = "white") +
  scale_color_manual(values = ch5_col, 
                     name = "", 
                     labels = c("Non hoarding", "Leftover hoarding", "Direct hoarding Htop", "Direct hoarding Rtop")) +
  theme(legend.position = "bottom")+  # Move legend to the bottom
  ylim(0,1)

```